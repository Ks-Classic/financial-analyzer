# 01. 製品概要

## コンセプト

財務レポートのAIコメント生成システム。Excel/PDFから抽出したデータと画像をGemini AIで分析し、経営報告用のコメントを自動生成する。

---

## ターゲットユーザー

- 財務・経理担当者
- 経営企画担当者
- コンサルタント

---

## 解決する課題

| 課題 | 解決策 |
|------|--------|
| 毎月同じ形式のレポート作成が手間 | AIで自動生成、前月比較も自動 |
| 12ページ分のコメント作成に時間がかかる | 一括キャッシュ＋並列生成で約20秒 |
| 顧客ごとにコメント形式が異なる | 顧客別設定保存で対応 |

---

## 主要機能

### 1. PDFコメント抽出
- PDFをアップロードして前月コメントを自動抽出
- ページ選択で対象ページを指定
- 顧客別にコメント抽出範囲を保存可能

### 2. 画像入力
- Ctrl+V または ドラッグ&ドロップで画像ペースト
- 一括モード: 全ページ貼り付け後に一括生成
- 逐次モード: ページごとに貼り付け→生成→次へ

### 3. 高速一括生成
- Gemini Context Caching API使用
- 全ページを一括キャッシュ（画像再送信不要）
- 3ページ同時並列生成
- **12ページ: 約20秒**（旧: 10分以上）

### 4. チャット修正
- 生成後、ページごとに自然言語で修正指示
- 例: 「もっと簡潔に」「数値を強調して」
- キャッシュ使用で超高速修正

### 5. レビュー・エクスポート
- ページナビゲーション（横並び目次）
- インライン編集
- 全コメント一括コピー

---

## 技術スタック

| レイヤー | 技術 |
|---------|------|
| フロントエンド | React + TypeScript + Vite |
| スタイリング | Tailwind CSS |
| AI | Google Gemini 3 (gemini-3-flash-preview) |
| PDF処理 | pdf.js |
| API | Vercel Serverless Functions |
| 状態管理 | React Hooks (useState, useCallback) |
| 設定保存 | localStorage |
| 画像保存 | IndexedDB（数百MB保存可能） |
| 共有（将来） | Supabase |

---

## ファイル構成

```
src/
├── components/
│   └── comment-generator/
│       ├── CommentGeneratorTabV4.tsx  # エントリーポイント
│       └── MultiPageAnalysis/
│           ├── index.tsx              # メインウィザード（6ステップ）
│           └── components/
│               ├── CommentCard.tsx        # レビュー用カード
│               ├── CommentRefiner.tsx     # 修正UI
│               ├── SequentialPageCapture.tsx  # 逐次モード
│               ├── ClientSettings.tsx     # 顧客設定
│               ├── RegionSelector.tsx     # コメント範囲選択
│               ├── PromptEditor.tsx       # プロンプト編集
│               └── ...
├── hooks/
│   ├── useCommentGeneration.ts   # 一括生成ロジック
│   ├── useClientSettings.ts      # 顧客設定管理
│   ├── useStreamingGeneration.ts # ストリーミング生成
│   └── useClipboardPaste.ts      # クリップボード処理
├── lib/
│   ├── gemini-vision.ts          # Gemini API
│   ├── pdf-utils.ts              # PDF処理
│   └── prompts.ts                # プロンプトテンプレート
└── types/
    └── multi-page-analysis.ts    # 型定義

api/
└── comment/
    ├── bulk-cache.ts       # 一括キャッシュ
    ├── generate-fast.ts    # 高速生成（キャッシュ使用）
    ├── generate-stream.ts  # ストリーミング生成
    ├── refine.ts           # コメント修正
    └── ...
```

---

## ワークフロー

```
┌─────────────────────────────────────────────────────────────────┐
│                    6ステップウィザード                          │
├─────────────────────────────────────────────────────────────────┤
│ Step 1: PDFアップロード                                         │
│   └── PDF読み込み → ページ/コメント抽出                        │
├─────────────────────────────────────────────────────────────────┤
│ Step 2: ページ選択                                              │
│   └── 対象ページをチェックボックスで選択                       │
├─────────────────────────────────────────────────────────────────┤
│ Step 3: 画像入力                                                │
│   └── 各ページに今月データ画像をペースト                       │
├─────────────────────────────────────────────────────────────────┤
│ Step 4: プロンプト設定                                          │
│   └── システム/ページ固有プロンプトを確認・調整                │
├─────────────────────────────────────────────────────────────────┤
│ Step 5: 一括生成                                                │
│   └── キャッシュ作成 → 並列生成（3ページ同時）                 │
├─────────────────────────────────────────────────────────────────┤
│ Step 6: 確認・編集                                              │
│   └── 結果確認 → インライン編集/チャット修正 → コピー          │
└─────────────────────────────────────────────────────────────────┘
```
