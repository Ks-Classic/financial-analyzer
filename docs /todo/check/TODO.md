# TODOリスト

本プロジェクトの今後のタスクリストです。優先度順に記載しています。

## フェーズ1: 分析＆デプロイ (最優先・並行作業)

### A. 分析精度の検証 (本番ファイル使用)
- [ ] **現状の分析実行**: 現在のコードで本番用PDFをアップロードし、どのような分析結果が返ってくるかを確認する。
- [ ] **結果の評価**:
    - [ ] 正しく指摘できている点は何か？
    - [ ] 指摘が漏れている点は何か？
    - [ ] 誤った指摘をしている点は何か？
    - [ ] テーブルデータ（行・列）の認識は正確か？
- [ ] **改善アクション**:
    - [ ] 評価結果に基づき、`apps/backend/src/api/analysis/analysis.service.ts` の **プロンプトを修正・改善** する。
    - [ ] 必要であれば、`pdf-parse`のオプションを調整し、テキスト抽出の品質を向上させる。

### B. デプロイ準備と実行 (CLIベース)
- [ ] **GCP (Backend) デプロイ**:
    - [ ] `pnpm gcp-auth` を実行し、GCPにログインする。
    - [ ] **Secret Managerの設定**: GCPコンソールで `GEMINI_API_KEY` をSecret Managerに登録する。(手動作業)
    - [ ] バックエンドコードを修正し、`.env` からではなく **Secret ManagerからAPIキーを読み込む**ようにする。
    - [ ] `pnpm gcp-build:backend` を実行し、コンテナイメージをビルド＆プッシュする。
    - [ ] `pnpm gcp-deploy:backend` を実行し、Cloud Runにデプロイする。
- [ ] **Vercel (Frontend) デプロイ**:
    - [ ] `pnpm vercel-deploy:frontend` スクリプト内の `YOUR_SCOPE` を自身のVercelスコープ名に書き換える。
    - [ ] フロントエンドのコードを修正し、APIの向き先を **環境変数 (`VITE_API_BASE_URL`)** で切り替えられるようにする。
    - [ ] `vercel login` を実行し、Vercelにログインする。
    - [ ] Vercelの管理画面で、本番環境の環境変数 `VITE_API_BASE_URL` に、GCPでデプロイしたバックエンドのURLを設定する。(手動作業)
    - [ ] `pnpm vercel-deploy:frontend` を実行し、デプロイする。

## フェーズ2: エラー箇所のハイライト機能実装 (優先度: 中)

*フェーズ1完了後、必要に応じて着手*
- [ ] 方針: `highlightText`をフロントエンドの`react-pdf`上で検索し、該当箇所をオーバーレイ表示する。

## フェーズ3: セキュリティと堅牢化 (優先度: 高)
- [ ] **Cloud Run認証**: `--allow-unauthenticated` を削除し、Vercelからのリクエストのみを許可するように認証を設定する (Identity-Aware Proxyなど)。
- [ ] **エラーハンドリング強化**: タイムアウト、APIからのエラーレスポンスなど、あらゆる異常系をハンドリングする。
- [ ] **ロギング**: GCPのLogging機能を活用し、本番環境でのエラー追跡を容易にする。

## その他・改善項目

- [ ] **単体テスト・結合テスト**: `packages`にテスト用の共有設定を作成し、重要なサービスやコンポーネントのテストコードを追加する。
- [ ] **UI/UXの改善**: ローディング表示の具体化、結果表示のフィルタリング機能など。 