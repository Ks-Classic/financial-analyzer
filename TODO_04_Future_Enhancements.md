# TODO: フェーズ4 - 将来的な拡張機能

## 目的
アプリケーションの機能性をさらに向上させ、ユーザーエクスペリエンスを高めるための将来的な拡張機能を計画する。

## 達成基準
*   ユーザー認証機能が実装され、ユーザーごとに分析結果が安全に管理される。
*   修正チェックリスト機能が実装され、ユーザーが指摘事項の修正状況を管理できる。
*   より高度なPDF処理やAI分析機能の導入が検討される。

## タスクリスト

- [ ] **1. 修正チェックリスト機能の実装**
  - [ ] **1.1. チェックリストUIコンポーネントの作成**
    - [ ] 分析結果リストの各項目に対応するチェックボックスとメモ欄を持つUIコンポーネントを作成する。
    - [ ] チェックリストの表示/非表示を切り替える機能を実装する。
  - [ ] **1.2. Firestoreでのチェックリストデータ管理**
    - [ ] `checklists` コレクションのスキーマに従って、チェックリスト項目をFirestoreに保存・更新するロジックをバックエンドに実装する。
    - [ ] ユーザーがチェックリストの状態（完了/未完了）やメモを変更した際に、リアルタイムでデータが更新されるようにする。
  - [ ] **1.3. 分析結果との同期**
    - [ ] 新しい分析結果が生成された際に、既存のチェックリスト項目と関連付け、重複を避けるためのロジックを検討する。

- [ ] **2. ユーザー認証機能の導入**
  - [ ] **2.1. Firebase Authenticationのセットアップ**
    - [ ] Firebase Authenticationを有効にし、メール/パスワード認証、またはGoogle認証などのプロバイダーを設定する。
    - [ ] ユーザー登録、ログイン、ログアウト機能をフロントエンドに実装する。
  - [ ] **2.2. ユーザーデータ管理**
    - [ ] ログインしたユーザーの情報をFirestoreの `users` コレクションに保存・更新するロジックを実装する。
    - [ ] 各分析結果やチェックリスト項目をユーザーIDに関連付けて保存する。
  - [ ] **2.3. バックエンドAPIの認証・認可**
    - [ ] バックエンドのAPIエンドポイントに認証ミドルウェアを導入し、認証されたユーザーのみがアクセスできるようにする。
    - [ ] ユーザーの役割に応じた認可ロジックを実装する（例: 管理者ユーザーのみが可能な操作など）。

- [ ] **3. パフォーマンス最適化とスケーリング**
  - [ ] **3.1. 大規模PDFファイル対応の強化**
    - [ ] 大容量PDFファイル（100MB以上）の分析に対応するため、GCP Pub/SubとCloud Tasksを用いた非同期処理の導入を検討する。
    - [ ] PDF解析とAI分析をワーカーサービスとして分離し、Cloud Runのコンカレンシーとメモリ使用量を最適化する。
  - [ ] **3.2. Firestoreのクエリ最適化**
    - [ ] 大量の分析結果やユーザーデータが増加した場合に備え、Firestoreのインデックス設計を見直し、クエリパフォーマンスを最適化する。
  - [ ] **3.3. キャッシュ戦略の導入**
    - [ ] 頻繁にアクセスされるデータ（例: 過去の分析結果）をRedisなどのキャッシュ層に保存し、応答速度を向上させる。

- [ ] **4. レポート生成とエクスポート機能**
  - [ ] **4.1. 分析結果レポートの生成**
    - [ ] AIの分析結果をCSVやPDF形式でエクスポートする機能を提供する。
    - [ ] ユーザーが選択した指摘事項のみをレポートに含めるオプションを提供する。
  - [ ] **4.2. レポートテンプレートのカスタマイズ**
    - [ ] 将来的に、ユーザーがレポートの出力形式や内容をカスタマイズできる機能を提供する。

### 3. 高度なPDF処理/AI分析の検討
*   **タスク**: OCR（光学文字認識）技術の導入を検討し、画像ベースのPDFからのテキスト抽出精度を向上させる。
    *   **担当**: AI
    *   **ステータス**: 未着手
    *   **備考**: Google Cloud Vision APIなどを検討します。
*   **タスク**: より詳細な財務分析（例: 業界ベンチマークとの比較、特定の財務比率の自動計算）のためのAIプロンプトの拡張。
    *   **担当**: AI
    *   **ステータス**: 未着手

### 4. 監査証跡・履歴機能の検討
*   **タスク**: どのユーザーがいつ、どのレポートを分析し、どのような修正が行われたかの履歴を追跡する機能の検討。
    *   **担当**: AI
    *   **ステータス**: 未着手
    *   **備考**: 法規制対応や内部監査のニーズに応じて検討します。 