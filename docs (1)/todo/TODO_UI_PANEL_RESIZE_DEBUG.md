# TODO: PDFビューアー パネルリサイズ問題解決

## 🎯 問題の定義
1. **幅調整の左右逆操作問題**: ビューアーと分析結果の幅調整が期待と逆の動作をしている
2. **PDFビューアーの動的サイズ調整問題**: 
   - 基本状態：幅調整に応じてPDFビューアーが動的にブロックサイズに合わせるべき
   - ズーム操作時：ブロックサイズを超えても拡大を優先すべき

## 📋 検証フェーズ1: 現状把握と仮説立案

### [ ] A1. 現在のパネル設定確認
- [ ] A1-1. `PanelGroup`の`direction`プロパティ確認
- [ ] A1-2. 各`Panel`の`defaultSize`と`minSize`確認  
- [ ] A1-3. パネルの順序（order）確認
- [ ] A1-4. `PanelResizeHandle`の配置確認

**仮説A**: パネルの順序やサイズ設定が期待と逆になっている

### [ ] B1. PDFビューアーのサイズ制御ロジック確認
- [ ] B1-1. `renderPage`関数内のサイズ計算ロジック確認
- [ ] B1-2. `currentScale`と`autoScale`の使い分け確認
- [ ] B1-3. コンテナサイズ取得方法確認
- [ ] B1-4. ResizeObserverの動作確認

**仮説B**: PDFビューアーのサイズ調整ロジックにズーム操作との競合がある

### [ ] C1. ローカル環境での動作確認手順確立
- [ ] C1-1. ローカル開発サーバー起動手順確認
- [ ] C1-2. ブラウザでの動作テスト項目定義
- [ ] C1-3. 各種ブラウザでの互換性確認

**仮説C**: 開発環境と本番環境で動作に差異がある

## 📋 検証フェーズ2: 具体的な問題特定

### [ ] D1. パネルリサイズ動作の詳細検証
- [ ] D1-1. リサイズハンドルをドラッグした時の実際の動作記録
- [ ] D1-2. 期待される動作との差異の具体的特定
- [ ] D1-3. ブラウザ開発者ツールでのDOM要素変化確認

**結果記録欄**: 
```
実際の動作: 
期待される動作: 
差異: 
```

### [ ] E1. PDFビューアーサイズ調整の詳細検証
- [ ] E1-1. 通常の幅調整時のPDFサイズ変化確認
- [ ] E1-2. ズームボタン操作時のPDFサイズ変化確認
- [ ] E1-3. 両方の操作の競合状況確認

**結果記録欄**:
```
通常調整時: 
ズーム操作時: 
競合状況: 
```

## 📋 検証フェーズ3: 解決策の実装と検証

### [ ] F1. パネル設定の修正
- [ ] F1-1. パネル順序の調整実装
- [ ] F1-2. デフォルトサイズの調整
- [ ] F1-3. ローカルでの動作確認

**実装結果**:
```
修正内容: 
動作結果: 
```

### [ ] G1. PDFサイズ制御ロジックの修正
- [ ] G1-1. ズーム状態とリサイズ状態の分離実装
- [ ] G1-2. 優先順位の明確化実装
- [ ] G1-3. ローカルでの動作確認

**実装結果**:
```
修正内容: 
動作結果: 
```

## 📋 検証フェーズ4: 最終確認とデプロイ

### [ ] H1. 統合テスト
- [ ] H1-1. 全機能の連携動作確認
- [ ] H1-2. 複数ブラウザでの動作確認
- [ ] H1-3. レスポンシブ動作確認

### [ ] I1. デプロイ準備
- [ ] I1-1. ローカル動作の最終確認
- [ ] I1-2. Gitコミット準備
- [ ] I1-3. Vercelデプロイ実行

## 🔄 進捗追跡

**開始日時**: 2024-12-19 (開始)
**現在のフェーズ**: フェーズ3実装中
**完了タスク数**: 10/25
**進捗率**: 40%

## 📝 検証ログ

### [2024-12-19] 検証A1-1の結果 ✅
```
PanelGroupのdirectionプロパティ: "horizontal" - 正常
```

### [2024-12-19] 検証A1-2の結果 ✅
```
Panel1 (PDFビューアー): defaultSize={50}, minSize={20}, order={1}
Panel2 (分析結果): defaultSize={50}, minSize={5}, order未指定
```

### [2024-12-19] 検証A1-3の結果 ✅
```
パネル順序: 
- Panel1: id="pdf-panel", order={1} (PDFビューアー)
- Panel2: order未指定 (分析結果)
問題発見: Panel2にorderが設定されていない
```

### [2024-12-19] 検証A1-4の結果 ✅
```
PanelResizeHandle: Panel1とPanel2の間に正しく配置されている
className: "w-2 bg-gray-100 hover:bg-gray-200 flex items-center justify-center cursor-col-resize"
```

### [2024-12-19] 検証B1-1の結果 ✅ 問題発見
```
renderPage関数のサイズ計算ロジック:
1. const fitScale = containerWidth / viewport.width * scale;
2. キャンバスサイズを調整されたviewportに設定
3. ResizeObserverでコンテナサイズ変化を監視

問題: ズーム操作とリサイズ操作が同じfitScaleロジックを共有している
→ ズーム時もコンテナサイズに強制的にフィットしてしまう
```

### [2024-12-19] 検証B1-2の結果 ✅ 問題発見
```
currentScaleとautoScaleの使い分け:
- autoScale: コンテナ幅に基づく自動調整スケール
- currentScale: ユーザー操作可能なスケール

問題: ズーム操作時にfitScaleでさらに調整されるため、
ユーザーの意図したズーム率が無効化される
```

### [2024-12-19] 検証C1-1の結果 ✅
```
ローカル開発サーバー起動確認:
http://localhost:5173 - 200 OK 
サーバーは正常に起動している
```

### [2024-12-19] 実装F1-1の結果 ✅
```
修正内容: Panel2に id="results-panel", order={2} を追加
期待効果: パネル順序の明確化により左右逆操作問題を解決
```

### [2024-12-19] 実装G1-1の結果 ✅
```
修正内容: 
1. isUserZooming状態を追加
2. ズーム操作時のfitScale無効化ロジック実装
3. ResizeObserver時の自動フィット有効化
4. ズームボタンにisUserZooming制御を追加

期待効果: ズーム操作とリサイズ操作の分離
```

### [2024-12-19] ローカル確認結果 ⚠️
```
1. パネルリサイズ: ✅ (左右逆問題解決)
2. PDFズーム: ❌ (パネルサイズを超えて拡大できない)
3. 自動フィット: ✅ (パネルリサイズ時に自動調整)
4. 連携動作: 不明 (2の問題により確認不可)

問題原因仮説:
A. 型エラーによりコンパイルが正しく動作していない
B. finalScaleの計算ロジックに問題がある
C. コンテナのoverflow設定がズーム表示を制限している
```

### [2024-12-19] 追加修正G1-2開始 🔧
```
修正対象:
1. 型エラーの解決
2. ズーム時のコンテナ制限解除
3. finalScale計算ロジックの改善
```

### [2024-12-19] 実装G1-2の結果 ✅
```
実装済み修正:
1. ✅ Panel2にorder={2}追加 - パネル順序明確化
2. ✅ isUserZoomingフラグ追加 - ズーム状態管理
3. ✅ ズーム時CSS制限解除 - max-w-full動的制御
4. ✅ overflow設定動的変更 - ズーム時スクロール有効化
5. ✅ デバッグコンソール出力追加 - 問題特定支援

期待効果:
- ズーム時: max-w-fullが無効化され、パネルサイズを超えて拡大可能
- リサイズ時: 自動的にisUserZooming=falseになり、自動フィット有効化
``` 