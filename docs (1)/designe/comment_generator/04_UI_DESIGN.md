# 財務コメント自動生成機能 - UI設計書

## 1. 画面一覧

| 画面ID | 画面名 | Phase | 説明 |
|--------|--------|-------|------|
| SCR-01 | コメント生成メイン画面 | 1 | アップロード〜生成までのメイン画面 |
| SCR-02 | シート選択画面 | 1 | Excelのシート一覧・選択 |
| SCR-03 | 範囲選択画面 | 1 | スプレッドシート風の範囲選択 |
| SCR-04 | コメント生成・編集画面 | 1 | 生成結果の表示・編集・コピー |
| SCR-05 | 顧客管理画面 | 2 | 顧客一覧・登録・編集 |
| SCR-06 | テンプレート設定画面 | 2 | ページごとの設定 |

---

## 2. 共通レイアウト

### 2.1 ヘッダー

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  🔵 AI財務レポートアナライザー                                              │
│                                                                             │
│  [レポートチェック]  [コメント生成]  [顧客管理]            [設定] [ヘルプ]  │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 カラーパレット

| 用途 | カラーコード | 説明 |
|------|-------------|------|
| Primary | `#2563EB` | メインアクション、選択状態 |
| Primary Light | `#DBEAFE` | 選択範囲ハイライト |
| Success | `#10B981` | 成功メッセージ、完了状態 |
| Warning | `#F59E0B` | 警告、注意喚起 |
| Error | `#EF4444` | エラーメッセージ |
| Background | `#F9FAFB` | ページ背景 |
| Surface | `#FFFFFF` | カード、モーダル背景 |
| Text Primary | `#111827` | 見出し、本文 |
| Text Secondary | `#6B7280` | 補足テキスト |
| Border | `#E5E7EB` | 枠線 |

---

## 3. SCR-01: コメント生成メイン画面

### 3.1 全体レイアウト

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  ヘッダー                                                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                     📁 Excelファイルをアップロード                    │ │
│  │                                                                       │ │
│  │                  ドラッグ＆ドロップ または クリックして選択           │ │
│  │                                                                       │ │
│  │                       対応形式: xlsx, xls                            │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                             │
│  ┌─────────────────────────┐    ┌─────────────────────────────────────────┐│
│  │ 📋 シート一覧           │    │ 📊 シートプレビュー                      ││
│  │                         │    │                                         ││
│  │ ● PL推移   (120行)     │    │ ┌─────────────────────────────────────┐ ││
│  │ ○ BS       (80行)      │    │ │ A    B      C      D      E    ... │ ││
│  │ ○ CF       (50行)      │    │ │ 1 項目  2501   2502   2503   2504   │ ││
│  │ ○ 技工士   (30行)      │    │ │ 2 売上高 19,990 17,983 18,487 19,091│ ││
│  │                         │    │ │ 3 ラボ  11,526 17,256 18,331 18,952│ ││
│  │                         │    │ │ ...                                │ ││
│  └─────────────────────────┘    │ └─────────────────────────────────────┘ ││
│                                 │                                         ││
│                                 │ [範囲選択モードへ →]                    ││
│                                 └─────────────────────────────────────────┘│
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 コンポーネント詳細

#### アップロードエリア

```
状態1: 初期状態
┌─────────────────────────────────────────┐
│           📁                            │
│   Excelファイルをアップロード           │
│                                         │
│   ドラッグ＆ドロップ または [選択]      │
│                                         │
│   対応形式: xlsx, xls (最大50MB)        │
└─────────────────────────────────────────┘
  背景: #F9FAFB
  枠線: 2px dashed #E5E7EB
  角丸: 8px

状態2: ドラッグオーバー
┌─────────────────────────────────────────┐
│           📁                            │
│   ここにドロップしてください            │
│                                         │
└─────────────────────────────────────────┘
  背景: #DBEAFE
  枠線: 2px dashed #2563EB

状態3: アップロード中
┌─────────────────────────────────────────┐
│           ⏳                            │
│   アップロード中...                     │
│   ████████████░░░░░░░░ 60%             │
└─────────────────────────────────────────┘

状態4: 完了
┌─────────────────────────────────────────┐
│   ✅ financial_data_2506.xlsx          │
│   4シート / 15.2 KB                    │
│                            [✕ 削除]    │
└─────────────────────────────────────────┘
  背景: #F0FDF4
  枠線: 1px solid #10B981
```

#### シート一覧

```
┌─────────────────────────────────────────┐
│ 📋 シート一覧                           │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ ● PL推移                            │ │  ← 選択中
│ │   120行 × 20列                      │ │     背景: #DBEAFE
│ └─────────────────────────────────────┘ │     枠線: 1px solid #2563EB
│ ┌─────────────────────────────────────┐ │
│ │ ○ BS                                │ │  ← 未選択
│ │   80行 × 15列                       │ │     背景: #FFFFFF
│ └─────────────────────────────────────┘ │     枠線: 1px solid #E5E7EB
│ ┌─────────────────────────────────────┐ │
│ │ ○ CF                                │ │
│ │   50行 × 12列                       │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ○ 技工士                            │ │
│ │   30行 × 18列                       │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 4. SCR-03: 範囲選択画面

### 4.1 全体レイアウト

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  ← 戻る     📐 範囲選択モード - PL推移                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────┐  ┌───────────────┐│
│  │     │ A      B       C       D       E     ...     │  │ 選択範囲      ││
│  │─────┼─────────────────────────────────────────────│  │               ││
│  │   1 │ 項目   2501    2502    2503    2504          │  │ A2:R44        ││
│  │   2 │┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓│  │ 43行 × 18列   ││
│  │   3 │┃ 売上高 19,990  17,983  18,487  19,091      ┃│  │               ││
│  │   4 │┃ ラボ  11,526  17,256  18,331  18,952      ┃│  │ ─────────────││
│  │   5 │┃ 入会金    -     100      61       9       ┃│  │               ││
│  │   6 │┃ 年会費  8,328    569      95     130      ┃│  │ 検出した月:   ││
│  │  ...│┃ ...                                       ┃│  │ 2501〜2506    ││
│  │  44 │┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛│  │               ││
│  │  45 │                                             │  │ 最新月: 2506  ││
│  │  46 │ 販管費分析                                  │  │ 前月: 2505    ││
│  │  47 │ 給料手当 6,846  6,883  6,864  7,067         │  │               ││
│  │  ...│ ...                                         │  │ ─────────────││
│  │     │                                             │  │               ││
│  │     │ ← スクロール可能 →                         │  │ 💡 行46-89に  ││
│  │     │                                             │  │ 別の表を検出  ││
│  └─────────────────────────────────────────────────────┘  │ [追加選択]   ││
│                                                           │               ││
│  操作ガイド:                                              └───────────────┘│
│  ドラッグで範囲を選択 | Escでキャンセル | 右クリックでメニュー             │
│                                                                             │
│                              [コメント生成へ進む →]                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 選択操作の視覚フィードバック

```
状態1: 選択なし
  セル: 白背景、薄いグリッド線

状態2: ホバー
  セル: 背景 #F3F4F6

状態3: 選択中（ドラッグ中）
┌───────────────────────────┐
│                           │  ← 半透明の青オーバーレイ
│   選択中の範囲            │     背景: rgba(37, 99, 235, 0.1)
│                           │     枠線: 2px solid #2563EB
└───────────────────────────┘

状態4: 選択確定
┌───────────────────────────┐
│                           │  ← 実線の枠
│   確定した範囲            │     枠線: 3px solid #2563EB
│                           │     角に ● のリサイズハンドル
└───────────────────────────┘
```

---

## 5. SCR-04: コメント生成・編集画面

### 5.1 全体レイアウト

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  ← 戻る     💬 コメント生成                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────┐  ┌─────────────────────────────┐  │
│  │ 📊 選択データ                        │  │ ⚙️ コメント設定              │  │
│  │                                     │  │                             │  │
│  │ ┌─────────────────────────────────┐ │  │ コメントモード:             │  │
│  │ │ 項目     2505      2506    前月比│ │  │ ○ お任せ（全項目分析）      │  │
│  │ │ 売上高   18,009   21,080  +17.1%│ │  │ ● 項目指定                  │  │
│  │ │ ラボ    17,806   20,634  +15.9%│ │  │                             │  │
│  │ │ 入会金       0      340    -   │ │  │ 分析対象項目:               │  │
│  │ │ 年会費      37       13  -64.9%│ │  │ ☑ 売上高                    │  │
│  │ │ ...                            │ │  │ ☑ 売上原価                  │  │
│  │ └─────────────────────────────────┘ │  │ ☐ 販管費                    │  │
│  │                                     │  │ ☐ 営業利益                  │  │
│  │                    [📋 表をコピー]  │  │ ☐ 経常利益                  │  │
│  └─────────────────────────────────────┘  │                             │  │
│                                          │ ─────────────────────────── │  │
│  ┌─────────────────────────────────────┐ │                             │  │
│  │ 💡 推奨分析項目                      │ │ 💡 変動の大きい項目:         │  │
│  │                                     │ │ • 入会金収入 (+340%)        │  │
│  │ 以下の項目で大きな変動を検出:       │ │ • ラボ (+15.9%)             │  │
│  │ • 入会金収入: 0 → 340 (+∞)         │ │                             │  │
│  │ • 年会費収入: 37 → 13 (-64.9%)     │ │ [サジェスト項目を追加]      │  │
│  └─────────────────────────────────────┘ └─────────────────────────────┘  │
│                                                                             │
│                            [🚀 コメント生成]                               │
│                                                                             │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ 📝 生成コメント                                                [編集]  ││
│  │                                                                         ││
│  │ ・売上高                                                                ││
│  │   2506月の売上高は21,080千円となり、前月比+17.1%の増加。               ││
│  │   主にラボ売上の回復（+15.9%）が寄与している。                         ││
│  │                                                                         ││
│  │ ・入会金収入                                                            ││
│  │   前月0円から340千円へ増加。新規MD会員の入会によるもの。               ││
│  │   グレードアップ会員からの入会金（10万円）が含まれる。                 ││
│  │                                                                         ││
│  │ ─────────────────────────────────────────────────────────────────────  ││
│  │                                                                         ││
│  │ [📋 コメントをコピー]                              [🔄 再生成]         ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 ボタンスタイル

```
プライマリボタン（コメント生成）:
┌───────────────────────┐
│  🚀 コメント生成      │   背景: #2563EB
│                       │   テキスト: #FFFFFF
└───────────────────────┘   ホバー: #1D4ED8
                           角丸: 8px
                           影: 0 4px 6px rgba(0,0,0,0.1)

セカンダリボタン（コピー）:
┌───────────────────────┐
│  📋 コピー            │   背景: #FFFFFF
│                       │   枠線: 1px solid #E5E7EB
└───────────────────────┘   テキスト: #374151
                           ホバー: 背景 #F9FAFB

成功状態（コピー後）:
┌───────────────────────┐
│  ✅ コピーしました    │   背景: #10B981
│                       │   テキスト: #FFFFFF
└───────────────────────┘   2秒後に元に戻る
```

### 5.3 ローディング状態

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│                               ⏳                                            │
│                                                                             │
│                        コメントを生成中...                                  │
│                                                                             │
│                   ████████████░░░░░░░░░░░░░░░░░░                           │
│                                                                             │
│                   財務データを分析しています                               │
│                   しばらくお待ちください                                   │
│                                                                             │
│                              [キャンセル]                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. コンポーネント仕様

### 6.1 スプレッドシートビューア

```typescript
interface SpreadsheetViewerProps {
  data: CellData[][];           // 2次元配列のセルデータ
  rowCount: number;             // 表示行数
  colCount: number;             // 表示列数
  selectedRange?: Range;        // 選択範囲
  onRangeSelect?: (range: Range) => void;  // 範囲選択コールバック
  readOnly?: boolean;           // 編集不可モード
  showRowNumbers?: boolean;     // 行番号表示
  showColHeaders?: boolean;     // 列ヘッダー表示
}

interface Range {
  startRow: number;
  endRow: number;
  startCol: number;
  endCol: number;
}

interface CellData {
  value: string | number;
  type: 'text' | 'number' | 'date' | 'empty';
  format?: CellFormat;
}
```

### 6.2 コメントエディタ

```typescript
interface CommentEditorProps {
  comment: string;              // コメントテキスト
  isEditing: boolean;           // 編集モードか
  onEdit: () => void;           // 編集開始
  onChange: (text: string) => void;  // テキスト変更
  onSave: () => void;           // 保存
  onCopy: () => void;           // コピー
  onRegenerate: () => void;     // 再生成
}
```

### 6.3 ファイルアップローダー

```typescript
interface FileUploaderProps {
  accept: string[];             // 許可する拡張子 ['.xlsx', '.xls']
  maxSize: number;              // 最大サイズ (bytes)
  onUpload: (file: File) => void;  // アップロード成功時
  onError: (error: UploadError) => void;  // エラー時
  isUploading: boolean;         // アップロード中か
  uploadProgress?: number;      // 進捗 (0-100)
}
```

---

## 7. レスポンシブ対応

### 7.1 ブレークポイント

| 名前 | 幅 | 対応 |
|------|-----|------|
| Desktop Large | 1440px+ | フル機能 |
| Desktop | 1280px-1439px | フル機能 |
| Desktop Small | 1024px-1279px | サイドパネル縮小 |
| Tablet | 768px-1023px | サポート外（警告表示） |
| Mobile | -767px | サポート外（警告表示） |

### 7.2 小画面警告

```
┌─────────────────────────────────────────┐
│                                         │
│   📱 この機能はPC画面での利用を        │
│      推奨しています                     │
│                                         │
│   画面幅 1024px 以上でご利用ください   │
│                                         │
│              [了解]                     │
│                                         │
└─────────────────────────────────────────┘
```

---

## 8. アクセシビリティ

### 8.1 キーボードナビゲーション

| キー | 動作 |
|------|------|
| Tab | フォーカス移動 |
| Shift+Tab | 逆方向フォーカス移動 |
| Enter | ボタン押下、選択確定 |
| Escape | モーダル閉じる、選択キャンセル |
| Arrow Keys | スプレッドシート内のセル移動 |
| Ctrl+C | 選択範囲コピー |

### 8.2 ARIAラベル

```html
<button aria-label="コメントをクリップボードにコピー">
  📋 コピー
</button>

<div role="grid" aria-label="Excelシートプレビュー">
  ...
</div>

<div role="alert" aria-live="polite">
  コピーしました
</div>
```

---

## 9. アニメーション

### 9.1 トランジション

| 対象 | プロパティ | 時間 | イージング |
|------|-----------|------|-----------|
| ボタンホバー | background-color | 150ms | ease-out |
| パネル開閉 | height, opacity | 200ms | ease-in-out |
| トースト表示 | transform, opacity | 300ms | ease-out |
| 選択範囲ハイライト | background-color | 100ms | ease-out |

### 9.2 ローディングアニメーション

```css
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.loading-spinner {
  animation: spin 1s linear infinite;
}
```

---

*作成日: 2025-12-16*
*バージョン: 1.0*
